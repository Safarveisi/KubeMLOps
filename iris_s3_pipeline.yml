# PIPELINE DEFINITION
# Name: iris
# Description: ETL pipeline
components:
  comp-download:
    executorLabel: exec-download
    outputDefinitions:
      artifacts:
        csv_file:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
  comp-for-loop-2:
    dag:
      tasks:
        persist:
          cachingOptions: {}
          componentRef:
            name: comp-persist
          inputs:
            artifacts:
              csv_file:
                componentInputArtifact: pipelinechannel--download-csv_file
            parameters:
              key:
                componentInputParameter: pipelinechannel--loop-item-param-1
          taskInfo:
            name: persist
    inputDefinitions:
      artifacts:
        pipelinechannel--download-csv_file:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
      parameters:
        pipelinechannel--loop-item-param-1:
          parameterType: STRING
  comp-persist:
    executorLabel: exec-persist
    inputDefinitions:
      artifacts:
        csv_file:
          artifactType:
            schemaTitle: system.Dataset
            schemaVersion: 0.0.1
      parameters:
        key:
          parameterType: STRING
deploymentSpec:
  executors:
    exec-download:
      container:
        command:
        - python
        - comp.py
        - --output_path
        - '{{$.outputs.artifacts[''csv_file''].path}}'
        env:
        - name: ENV
          value: anything
        image: ciaa/download:v2.0.0
    exec-persist:
      container:
        command:
        - python
        - comp.py
        - --input_path
        - '{{$.inputs.artifacts[''csv_file''].path}}'
        - --key
        - '{{$.inputs.parameters[''key'']}}'
        image: ciaa/cleaning:v6.0.0
pipelineInfo:
  description: ETL pipeline
  name: iris
root:
  dag:
    tasks:
      download:
        cachingOptions: {}
        componentRef:
          name: comp-download
        taskInfo:
          name: download
      for-loop-2:
        componentRef:
          name: comp-for-loop-2
        dependentTasks:
        - download
        inputs:
          artifacts:
            pipelinechannel--download-csv_file:
              taskOutputArtifact:
                outputArtifactKey: csv_file
                producerTask: download
        iteratorPolicy:
          parallelismLimit: 3
        parameterIterator:
          itemInput: pipelinechannel--loop-item-param-1
          items:
            raw: '["ml_platform/iris_0.csv", "ml_platform/iris_1.csv", "ml_platform/iris_2.csv",
              "ml_platform/iris_3.csv", "ml_platform/iris_4.csv"]'
        taskInfo:
          name: for-loop-2
schemaVersion: 2.1.0
sdkVersion: kfp-2.11.0
---
platforms:
  kubernetes:
    deploymentSpec:
      executors:
        exec-persist:
          secretAsEnv:
          - keyToEnv:
            - envVar: bucket
              secretKey: S3_BUCKET
            secretName: s3-credentials
          - keyToEnv:
            - envVar: access_key
              secretKey: AWS_ACCESS_KEY_ID
            secretName: s3-credentials
          - keyToEnv:
            - envVar: secret_key
              secretKey: AWS_SECRET_ACCESS_KEY
            secretName: s3-credentials
          - keyToEnv:
            - envVar: endpoint_url
              secretKey: S3_ENDPOINT_URL
            secretName: s3-credentials
